/**
 * MDL Key-Value List
 *
 * LICENSE
 *
 * This source file is subject to the new BSD license that is bundled
 * with this package in the file LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://webhemi.gixx-web.com/license/new-bsd
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@gixx-web.com so we can send you a copy immediately.
 *
 * @author    Gabor Ivan <gixx@gixx-web.com>
 * @copyright 2015 Gixx-web (http://www.gixx-web.com)
 * @license   http://webhemi.gixx-web.com/license/new-bsd   New BSD License
 * @link      http://www.gixx-web.com
 */
(function(){var a=function a(b){this.element_=b;this.init()};window.MaterialKeyvaluelist=a;a.prototype.CssClasses_={IS_UPGRADED:"is-upgraded",JS_KVL:"mdl-js-kvl",KVL_SOCIALNETS:"mdl-kvl-socialnetworks",KVL_MESSENGERS:"mdl-kvl-instantmessengers",KVL_PHONES:"mdl-kvl-phones"};a.prototype.dataTypes_={KLV_TYPE_TEXT:"text",KVL_TYPE_EMAIL:"email",KVL_TYPE_URL:"url",KVL_TYPE_TEL:"tel"};a.prototype.dataPattern_={text:".+",email:"[a-z0-9\\.\\_\\%\\+\\-]+\\@[a-z0-9]([a-z0-9\\.\\-]*[a-z0-9\\.\\-])?\\.[a-z]{2,4}",url:"https?\\:\\/\\/[a-z0-9]([a-z0-9\\.\\-]*[a-z0-9\\.\\-])?\\.[a-z]{2,4}\\/?[a-zA-Z0-9\\.\\/\\?\\-\\_\\#\\%\\&\\@\\=\\+]*",tel:"((\\+[0-9]{2}|0[0-9]{1,4})[- ]?)?(\\([0-9]{1,3}\\)|[0-9]{1,3})[- \\/]?[0-9]{3,4}[- ]?[0-9]{3,4}"};a.prototype.listID_=null;a.prototype.listDataType_="text";a.prototype.useListDataPattern_=false;a.prototype.listDataPattern_="";a.prototype.listDataPlaceholder_="";a.prototype.addButton_={};a.prototype.storedValue_={};a.prototype.keyValueList_={};a.prototype.Services_={"mdl-kvl-socialnetworks":["Bebo","Facebook","Flickr","Google+","Habbo","Instagram","LinkedIn","Orkut","Qzone","Sina Weibo","Tagged","Tumblr","Twitter","VK","Xing"],"mdl-kvl-instantmessengers":["Aim","AOL On","Ch@t On","Facebook Messenger","FaceTime","Google Hangouts","ICQ","imo","Kakao Talk","line","QQ","Skype","Snapchat","Viber","WeChat","WhatsApp"],"mdl-kvl-phones":["Mobile","Home","Work","Work Fax","Home Fax","Pager","Other","Custom","Callback"]};a.prototype.addRow_=function(b){b.preventDefault();this.createRow_("","")};a.prototype.createRow_=function(c,f){var e=this.keyValueList_.childNodes.length;var b=this.listID_+"-list-element-"+e;var d=document.createElement("li");d.classList.add("mdl-kvl__list-element");d.setAttribute("id",b);d.innerHTML='<div class="mdl-kvl__list-key mdl-textfield mdl-js-textfield">   <input required list="mld-kvl-data-'+this.listID_+'" id="'+this.listID_+"-key-"+e+'" data-value="'+this.listID_+"-value-"+e+'" type="text" class="mdl-textfield__input mdl-kvl__list-element-key" name="'+this.listID_+"-key["+e+']" value="'+c+'" pattern=".+" />   <label class="mdl-textfield__label" for="'+this.listID_+"-key-"+e+'">Service</label></div><div class="mdl-kvl__list-value mdl-textfield mdl-js-textfield">   <input required id="'+this.listID_+"-value-"+e+'" data-key="'+this.listID_+"-key-"+e+'" type="'+this.listDataType_+'" '+(this.useListDataPattern_?' pattern="'+this.listDataPattern_+'"':"")+'class="mdl-textfield__input mdl-kvl__list-element-value" name="'+this.listID_+"-value["+e+']" value="'+f+'" />   <label class="mdl-textfield__label" for="'+this.listID_+"-value-"+e+'">'+this.listDataPlaceholder_+'</label>   <span class="mdl-textfield__error">Input is not valid!</span></div><div class="mdl-kvl__list-remove">   <button type="button" id="'+this.listID_+"-delete-"+e+'" class="mdl-button mdl-js-button mdl-button--icon mdl-button--accent">       <i class="material-icons">remove</i>   </button></div>';this.keyValueList_.appendChild(d);componentHandler.upgradeDom();window.getComputedStyle(d).opacity;document.getElementById(this.listID_+"-key-"+e).addEventListener("change",this.inputChange_.bind(this),true);document.getElementById(this.listID_+"-value-"+e).addEventListener("keyup",this.inputChange_.bind(this),true);document.getElementById(this.listID_+"-delete-"+e).addEventListener("click",this.deleteRow_.bind(this),true);d.classList.add("show")};a.prototype.resetList_=function(){if(this.element_.getElementsByTagName("ul").length>0){this.element_.removeChild(this.element_.querySelector("ul"))}this.keyValueList_=document.createElement("ul");this.keyValueList_.classList.add("mdl-kvl__list");this.element_.appendChild(this.keyValueList_);if(this.storedValue_){for(var b in this.storedValue_){if(this.storedValue_.hasOwnProperty(b)){this.createRow_(b,this.storedValue_[b])}}}};a.prototype.deleteRow_=function(c){c.preventDefault();var e=this;for(var b=0;b<c.path.length;b++){var f=c.path[b];if(f.tagName=="BODY"){break}if(f.tagName=="LI"&&f.classList.contains("mdl-kvl__list-element")){if(typeof f.parentNode!="undefined"){var d=parseFloat(window.getComputedStyle(f).transitionDuration)*1000;f.classList.remove("show");setTimeout(function(){if(f.parentNode){f.parentNode.removeChild(f)}e.inputChange_(c)},d)}break}}};a.prototype.inputChange_=function(c){c.preventDefault();var g=this.element_.querySelectorAll(".mdl-kvl__list-element input");var e={};for(var f=0;f<g.length;f++){var h=g[f];var k="";var j="";var d="";var b="";if(!h.value.trim()){h.parentNode.classList.add("is-invalid")}else{if(h.classList.contains("mdl-kvl__list-element-key")){b=h.getAttribute("data-value");k=h.value.trim();j=this.element_.querySelector("#"+b).value.trim()}else{d=h.getAttribute("data-key");k=this.element_.querySelector("#"+d).value.trim();j=h.value.trim()}}if(k&&j){e[k]=j}}this.storedValue_=e;this.element_.querySelector("textarea").value=JSON.stringify(e)};a.prototype.init=function(){if(this.element_){var c=this.element_.querySelector("textarea");this.listID_=c.getAttribute("id");if(c.hasAttribute("data-placeholder")){this.listDataPlaceholder_=c.getAttribute("data-placeholder")}if(c.hasAttribute("data-type")){var h=c.getAttribute("data-type");for(var g in this.dataTypes_){if(this.dataTypes_[g]==h){this.listDataType_=this.dataTypes_[g];break}}}if(c.hasAttribute("data-pattern")){this.useListDataPattern_=true;var k=c.getAttribute("data-pattern");if(""==k){k=this.dataPattern_[this.listDataType_]}this.listDataPattern_=k}var b=document.getElementById(this.listID_).value;if(b){this.storedValue_=JSON.parse(b)}this.addButton_=document.createElement("div");this.addButton_.classList.add("mdl-kvl__list-add");this.addButton_.innerHTML='   <button type="button" class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored">       <i class="material-icons">add</i>   </button>';this.element_.appendChild(this.addButton_);for(var g in this.Services_){if(this.element_.classList.contains(g)){var f=document.createElement("datalist");f.setAttribute("id","mld-kvl-data-"+this.listID_);var e=[];for(var d=0;d<this.Services_[g].length;d++){e[d]=document.createElement("option");e[d].setAttribute("value",this.Services_[g][d]);f.appendChild(e[d])}this.element_.appendChild(f);break}}this.resetList_();this.addButton_.addEventListener("click",this.addRow_.bind(this));this.element_.classList.add(this.CssClasses_.IS_UPGRADED)}};componentHandler.register({constructor:a,classAsString:"MaterialKeyvaluelist",cssClass:"mdl-js-kvl",widget:true})})();